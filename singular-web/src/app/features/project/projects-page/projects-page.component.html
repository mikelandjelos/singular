<div class="header">
      <h2>Projects</h2>
      <span class="spacer"></span>
      <button mat-flat-button color="primary" (click)="openCreateDialog()">
        <mat-icon>add</mat-icon>&nbsp;New Project
      </button>
    </div>

    <div class="filters">
      <mat-form-field class="search" appearance="outline">
        <mat-label>Search projects</mat-label>
        <input
          matInput
          [(ngModel)]="q"
          (ngModelChange)="onQueryChange($event)"
          placeholder="name or description"
        />
        @if (q) {
          <button matSuffix mat-icon-button aria-label="Clear" (click)="onQueryChange(''); q = ''">
            <mat-icon>close</mat-icon>
          </button>
        }
      </mat-form-field>

      <span class="spacer"></span>

      <mat-slide-toggle [checked]="archived()" (change)="toggleArchived($event.checked)">
        Show archived
      </mat-slide-toggle>
    </div>

    <div class="table-wrap">
      <table mat-table [dataSource]="projects()">
        <!-- Pinned -->
        <ng-container matColumnDef="pinned">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let p">
            <button
              mat-icon-button
              class="pin-btn"
              [color]="p.pinned ? 'primary' : undefined"
              [class.is-pinned]="p.pinned"
              [matTooltip]="p.pinned ? 'Unpin' : 'Pin'"
              (click)="togglePin(p)"
            >
              <mat-icon>push_pin</mat-icon>
            </button>
          </td>
        </ng-container>

        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Name</th>
          <td mat-cell *matCellDef="let p">
            <div class="name-block">
              <div class="title">{{ p.name }}</div>
              @if (p.description) {
                <div class="desc">{{ p.description }}</div>
              }
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="updatedAt">
          <th mat-header-cell *matHeaderCellDef>Updated</th>
          <td mat-cell *matCellDef="let p">{{ p.updatedAt | date: 'medium' }}</td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let p">
            <button
              matButton="outlined"
              [disabled]="p.deletedAt"
              [inert]="true"
              [class]="p.deletedAt ? 'success' : 'error'"
              [class.archived]="!!p.deletedAt"
              [class.active]="!p.deletedAt"
            >
              {{ p.deletedAt ? 'Archived' : 'Active' }}
            </button>
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let p">
            <button mat-icon-button matTooltip="Edit" (click)="openEditDialog(p)">
              <mat-icon>edit</mat-icon>
            </button>

            <button mat-icon-button *ngIf="!p.deletedAt" matTooltip="Archive" (click)="archive(p)">
              <mat-icon>archive</mat-icon>
            </button>
            <button mat-icon-button *ngIf="p.deletedAt" matTooltip="Restore" (click)="restore(p)">
              <mat-icon>unarchive</mat-icon>
            </button>

            <button
              mat-icon-button
              color="warn"
              matTooltip="Delete forever"
              (click)="hardDelete(p)"
            >
              <mat-icon>delete_forever</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedCols()"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedCols()"
          [ngStyle]="rowStyle(row)"
          [class.row-pinned]="row.pinned"
        ></tr>
      </table>

      <mat-paginator
        [length]="total()"
        [pageIndex]="pageIndex()"
        [pageSize]="pageSize()"
        [pageSizeOptions]="[10, 20, 50, 100]"
        (page)="onPage($event)"
      >
      </mat-paginator>
    </div>
