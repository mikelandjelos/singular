<section class="p-4">
  @if (user$ | async; as user) {
    <mat-card appearance="outlined">
      <mat-card-header>
        <mat-card-title>My Profile</mat-card-title>
        <mat-card-subtitle
          >{{ user?.email }} (<b [className]="user.deletedAt === null ? 'green' : 'red'">{{
            user.deletedAt === null ? 'Activated' : 'Archived'
          }}</b
          >)</mat-card-subtitle
        >
      </mat-card-header>

      <mat-card-content>
        <div class="grid">
          <div>
            <h3 class="section">Basics</h3>
            <mat-list>
              <mat-list-item>
                <mat-icon matListItemIcon>account_circle</mat-icon>
                <div matListItemTitle>{{ user.displayName }}</div>
                <div matListItemLine>ID: {{ user.id }}</div>
              </mat-list-item>
              @if (user.firstName || user.lastName) {
                <mat-list-item>
                  <mat-icon matListItemIcon>badge</mat-icon>
                  <div matListItemTitle>
                    {{ (user.firstName || '') + ' ' + (user.lastName || '') }}
                  </div>
                  <div matListItemLine>Full name</div>
                </mat-list-item>
              }
              @if (user.headline) {
                <mat-list-item>
                  <mat-icon matListItemIcon>short_text</mat-icon>
                  <div matListItemTitle>{{ user.headline }}</div>
                  <div matListItemLine>Headline</div>
                </mat-list-item>
              }
            </mat-list>
          </div>

          <div>
            <h3 class="section">Contact</h3>
            <mat-list>
              @if (user.phone) {
                <mat-list-item>
                  <mat-icon matListItemIcon>call</mat-icon>
                  <div matListItemTitle>{{ user.phone }}</div>
                  <div matListItemLine>Phone</div>
                </mat-list-item>
              }
              @if (user.location) {
                <mat-list-item>
                  <mat-icon matListItemIcon>place</mat-icon>
                  <div matListItemTitle>{{ user.location }}</div>
                  <div matListItemLine>Location</div>
                </mat-list-item>
              }
              @if (user.website) {
                <mat-list-item>
                  <mat-icon matListItemIcon>public</mat-icon>
                  <div matListItemTitle>
                    <a [href]="user.website" target="_blank" rel="noopener">{{ user.website }}</a>
                  </div>
                  <div matListItemLine>Website</div>
                </mat-list-item>
              }
            </mat-list>
          </div>
        </div>

        @if (user.summaryMd) {
          <mat-divider class="my-3"></mat-divider>
          <h3 class="section">Summary</h3>
          <markdown [data]="user.summaryMd"></markdown>
        }

        <mat-divider class="my-3"></mat-divider>

        <div class="grid">
          <!-- Skills + Languages -->
          <div>
            @if (user.skills?.length) {
              <h3 class="section">Skills</h3>
              <mat-chip-set>
                @for (s of user.skills; track $index) {
                  <mat-chip>{{ s }}</mat-chip>
                }
              </mat-chip-set>
            }
            @if (user.languages?.length) {
              <h3 class="section">Languages</h3>
              <mat-chip-set>
                @for (language of user.languages; track $index) {
                  <mat-chip>{{ language | titlecase }}</mat-chip>
                }
              </mat-chip-set>
            }
          </div>

          <!-- Links -->
          <div>
            @if (user.links?.length) {
              <h3 class="section">Links</h3>
              <mat-list>
                @for (link of user.links; track $index) {
                  <mat-list-item>
                    <mat-icon matListItemIcon>link</mat-icon>
                    <div matListItemTitle>{{ link.label }}</div>
                    <div matListItemLine>
                      <a [href]="link.url" target="_blank" rel="noopener">{{ link.url }}</a>
                    </div>
                  </mat-list-item>
                }
              </mat-list>
            }
          </div>
        </div>
        <mat-card-actions align="end">
          <button mat-stroked-button class="refresh-button" color="primary" (click)="refresh()">
            Refresh
          </button>
          <a mat-flat-button color="accent" [routerLink]="['/', user.id, 'profile', 'edit']">
            Edit Personal Info
          </a>
        </mat-card-actions>
      </mat-card-content>
    </mat-card>
  } @else {
    <div class="spinner">
      <mat-spinner></mat-spinner>
    </div>
  }
</section>
